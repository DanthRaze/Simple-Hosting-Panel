<!DOCTYPE html>
<html>
<head>
    <title>Simple Hosting Panel</title>
    <link rel="stylesheet" href="node_modules/xterm/css/xterm.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <div id="ip-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content help-modal">
            <div class="modal-header">
                <h3><i class="fas fa-network-wired"></i> Connection Guide</h3>
                <button onclick="toggleIpHelp()" class="close-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="help-body">
                <h4>How do others connect?</h4>
                <p>Players join using your <strong>Public IP</strong> and <strong>Port</strong> (e.g., <code>123.45.67.89:25565</code>).</p>
                
                <h4>Port Forwarding (Required)</h4>
                <p>For friends outside your WiFi to join, you must "Forward" the port in your router settings.</p>
                <ol>
                    <li>Login to your router (usually <code>192.168.0.1</code> or <code>192.168.1.1</code>).</li>
                    <li>Find <strong>"Port Forwarding"</strong> or "Virtual Servers".</li>
                    <li>Create a new rule:
                        <ul>
                            <li><strong>Port:</strong> 25565 (or your chosen port)</li>
                            <li><strong>Type:</strong> TCP & UDP</li>
                            <li><strong>IP Address:</strong> Your computer's local IPv4.</li>
                        </ul>
                    </li>
                </ol>
                <div class="alert-box">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <strong>Note:</strong> The "Server IP" displayed above is fetched automatically but may change if your ISP uses dynamic IPs.
                </div>
            </div>
        </div>
    </div>

    <div id="setup-modal">
        <div class="modal-content large-modal">
            <h2><i class="fas fa-server"></i> Server Setup</h2>
            
            <div class="setup-tabs">
                <button class="tab-btn active" onclick="switchSetupTab('create')">Create New Server</button>
                <button class="tab-btn" onclick="switchSetupTab('import')">Import Existing</button>
            </div>

            <div id="tab-create" class="setup-tab-content active">
                <div class="form-group">
                    <label>1. Installation Folder</label>
                    <div style="display:flex; gap:10px;">
                        <button class="btn-secondary" id="btn-create-folder" style="flex:1">Select Empty Folder</button>
                    </div>
                    <p id="create-path-display" class="path-text">No folder selected</p>
                </div>

                <div class="form-group">
                    <label>Server Software & Version</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <select id="api-type-select" class="input-dark" onchange="updateSoftwareVersions()">
                            <option>Loading Software...</option>
                        </select>
                        <select id="version-select" class="input-dark" onchange="syncSelectionToHiddenFields()">
                            <option>Version...</option>
                        </select>
                    </div>
                    
                    <input type="hidden" id="setup-jar">
                    <input type="hidden" id="setup-download-url">
                </div>

                <div class="form-group">
                    <label>4. Initial Settings</label>
                    <div class="cols">
                        <div>
                            <label>RAM (GB)</label>
                            <input type="number" id="create-ram" value="4" min="1" max="32">
                        </div>
                        <div>
                            <label>Port</label>
                            <input type="number" id="create-port" value="25565">
                        </div>
                    </div>
                </div>

                <button class="btn-action start" id="btn-install-server" style="width:100%; justify-content:center; margin-top:10px;" disabled>
                    <i class="fas fa-download"></i> Download & Install
                </button>
                <p id="install-status" style="margin-top:10px; font-size:12px; color:#aaa;"></p>
            </div>

            <div id="tab-import" class="setup-tab-content">
                <button class="btn-main" id="btn-select-folder">Select Server Folder</button>
                <p id="selected-path" class="path-text">No folder selected</p>
                
                <label>Select JAR File</label>
                <select id="jar-select"><option>Select Folder First</option></select>
                
                <br><br>
                <label>RAM Allocation (GB)</label>
                <input type="range" id="setup-ram" min="1" max="16" value="4" oninput="this.nextElementSibling.value = this.value + ' GB'">
                <output>4 GB</output>
                
                <br><br>
                <div class="cols">
                    <div>
                        <label>RCON Port</label>
                        <input type="number" id="setup-rcon-port" value="25575">
                    </div>
                    <div>
                        <label>RCON Password</label>
                        <input type="password" id="setup-rcon-pw" placeholder="Secret123">
                    </div>
                </div>

                <button class="btn-action" id="btn-finish-setup" style="width: 100%; justify-content: center; margin-top: 25px;">Import Server</button>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-cube"></i> Hosting Panel</div>
        <div class="nav-item active" onclick="showPage('performance')"><i class="fas fa-chart-line"></i> Performance</div>
        <div class="nav-item" onclick="showPage('console')"><i class="fas fa-terminal"></i> Console</div>
        <div class="nav-item" onclick="showPage('players')"><i class="fas fa-users"></i> Players</div>
        <div class="nav-item" onclick="showPage('files')"><i class="fas fa-folder"></i> File Manager</div>
        <div class="nav-item" onclick="showPage('backups')"><i class="fas fa-archive"></i> Backups</div>
        <div class="nav-item" onclick="showPage('settings')"><i class="fas fa-cog"></i> Settings</div>
        <div class="nav-item" onclick="showPage('plugins')" id="nav-plugins"><i class="fas fa-puzzle-piece"></i> Mods & Plugins</div>
        
        <div style="flex:1"></div>
        <div class="copyright">
            &copy; Theo Tech 2026
        </div>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div id="server-name">Server Dashboard</div>
            
            <div class="server-address-box">
                <div class="addr-item">
                    <span class="addr-label">IP:</span>
                    <span id="header-ip" class="addr-val">Fetching...</span>
                    <button class="help-btn" onclick="toggleIpHelp()">?</button>
                </div>
                <div class="addr-item">
                    <span class="addr-label">Port:</span>
                    <span id="header-port" class="addr-val">...</span>
                    <button class="help-btn" onclick="toggleIpHelp()">?</button>
                </div>
            </div>

            <div class="controls">
                <span class="status-badge" id="status-badge">OFFLINE</span>
                <button class="btn-action start" id="start-btn"><i class="fas fa-play"></i> Start</button>
                <button class="btn-action restart" id="restart-btn"><i class="fas fa-redo"></i> Restart</button>
                <button class="btn-action stop" id="stop-btn"><i class="fas fa-stop"></i> Stop</button>
                <button class="btn-action kill" id="kill-btn"><i class="fas fa-skull"></i> Kill</button>
            </div>
        </div>

        <div id="page-performance" class="page active">
            <div class="stats-grid">
                <div class="card">
                    <div class="stat-value" id="cpu-val">0%</div>
                    <div class="stat-label">CPU Load</div>
                </div>
                <div class="card">
                    <div class="stat-value" id="ram-val">0 MB</div>
                    <div class="stat-label">RAM Usage</div>
                </div>
            </div>
            <div class="card chart-card">
                <canvas id="perfChart"></canvas>
            </div>
        </div>

        <div id="page-console" class="page">
            <div id="terminal-container"></div>
        </div>

        <div id="page-players" class="page">
            <h3>Player Management</h3>
            <div class="card" style="padding:0; overflow:hidden;">
                <table class="player-table">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Name</th>
                            <th>UUID</th>
                            <th>Whitelist</th>
                            <th>OP</th>
                            <th>Ban</th>
                        </tr>
                    </thead>
                    <tbody id="player-list-body"></tbody>
                </table>
            </div>
        </div>

        <div id="page-files" class="page">
            <div id="file-browser">
                <div class="breadcrumb">
                    <button id="btn-root">Home</button> <span id="current-path-display">/</span>
                    <button id="btn-back" disabled>⬆ Up</button>
                </div>
                <div class="file-list" id="file-list-container"></div>
            </div>
            <div id="file-editor" style="display:none;">
                <div class="editor-toolbar">
                    <button class="btn-secondary" onclick="closeEditor()">Close</button>
                    <span id="editing-filename">filename.txt</span>
                    <button class="btn-action" id="btn-save-file">Save Changes</button>
                </div>
                <textarea id="editor-textarea"></textarea>
            </div>
        </div>

        <div id="page-backups" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3>Server Backups</h3>
                <button class="btn-action" onclick="createNewBackup()"><i class="fas fa-plus"></i> Create Backup</button>
            </div>

            <div class="card" style="margin-bottom: 20px; border: 1px solid #30363d; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <i class="fab fa-google-drive" style="font-size: 32px; color: #34A853;"></i>
                    <div>
                        <h4 style="margin: 0; color: #fff; border:none; padding:0;">Google Drive Integration</h4>
                        <p style="margin: 5px 0 0; color: #8b949e; font-size: 12px;">Securely save backups to your cloud. App only accesses files it creates.</p>
                    </div>
                </div>
                <div id="drive-status-container">
                    <button class="btn-action" id="btn-drive-link" style="background: #30363d;">Loading...</button>
                </div>
            </div>

            <div class="backup-list" id="backup-list">
            </div>
        </div>

        <div id="page-plugins" class="page">
            <div class="header-row" style="margin-bottom: 20px;">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="plugin-query" class="input-dark" placeholder="Search Modrinth..." onkeyup="if(event.key==='Enter') searchModrinth()">
                </div>
                <button class="btn-main" onclick="searchModrinth()" style="width: 120px; margin: 0;">Search</button>
            </div>

            <div id="plugin-results" class="plugin-grid">
            </div>
        </div>
        <div id="page-settings" class="page">
            <h3>Server Configuration</h3>
            <div class="settings-grid">
                
                <div class="card">
                    <h4>General</h4>
                    <label>RAM Allocation (Restart Required)</label>
                    <div class="slider-container">
                        <input type="range" id="set-ram" min="1" max="16" step="1">
                        <span id="ram-disp">4 GB</span>
                    </div>

                    <label>Max Players</label>
                    <input type="number" id="prop-max-players" class="input-dark">

                    <label>View Distance</label>
                    <input type="number" id="prop-view-distance" class="input-dark">
                </div>

                <div class="card">
                    <h4>Network & Connection</h4>
                    <label>Server Port</label>
                    <input type="number" id="prop-server-port" class="input-dark">
                    
                    <label>Server IP (Binding)</label>
                    <input type="text" id="prop-server-ip" class="input-dark" placeholder="Leave blank (Recommended)">
                    <p class="subtext">Only change Server IP if you have multiple network adapters. Leave blank to listen on all.</p>

                    <label>RCON Port</label>
                    <input type="number" id="set-rcon-port" class="input-dark">
                    
                    <label>RCON Password</label>
                    <input type="password" id="set-rcon-pw" class="input-dark">
                </div>

                <div class="card">
                    <h4>Gameplay</h4>
                    <label>Gamemode</label>
                    <select id="prop-gamemode" class="input-dark">
                        <option value="survival">Survival</option>
                        <option value="creative">Creative</option>
                        <option value="adventure">Adventure</option>
                    </select>

                    <label>Difficulty</label>
                    <select id="prop-difficulty" class="input-dark">
                        <option value="peaceful">Peaceful</option>
                        <option value="easy">Easy</option>
                        <option value="normal">Normal</option>
                        <option value="hard">Hard</option>
                    </select>

                    <div class="toggle-row">
                        <span>Enable Whitelist</span>
                        <input type="checkbox" id="prop-white-list">
                    </div>
                </div>

                <div class="setting-group">
                        <h4><i class="fab fa-discord"></i> Discord Integration 
                            <span class="help-btn" onclick="toggleDiscordHelp()" style="cursor:pointer; font-size:14px;">?</span>
                        </h4>
                        <p class="subtext">Control your server via Discord DMs.</p>
                        
                        <div class="setting-row">
                            <span>Enable Bot</span>
                            <label class="switch">
                                <input type="checkbox" id="discord-enabled">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="form-group" style="margin-top:15px;">
                            <label>Bot Token</label>
                            <input type="password" id="discord-token" class="input-dark" placeholder="MTAyMzI...">
                            <div id="discord-invite-area" style="margin-top:10px; display:none;">
                                <a id="discord-invite-link" href="#" target="_blank" style="color:var(--accent-primary); font-size:12px;">
                                    <i class="fas fa-external-link-alt"></i> Click here to invite the bot to your server
                                </a>
                            </div>
                        </div>
                    </div>

                    <div id="discord-help-modal" class="modal-overlay" style="display: none;">
                        <div class="modal-content help-modal">
                            <div class="modal-header">
                                <h3>Discord Bot Setup</h3>
                                <button onclick="toggleDiscordHelp()" class="close-btn"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="help-body">
                                <ol>
                                    <li>Go to the <a href="https://discord.com/developers/applications" target="_blank">Discord Developer Portal</a>.</li>
                                    <li>Click <strong>"New Application"</strong> and name it.</li>
                                    <li>Go to <strong>"Bot"</strong> settings, click <strong>"Reset Token"</strong> to get your token.</li>
                                    <li>Scroll down to <strong>"Privileged Gateway Intents"</strong> and enable <strong>"Message Content Intent"</strong>.</li>
                                    <li>Paste the token into this panel and save!</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                
                <div class="card full-width">
                    <h4><i class="fas fa-sliders-h"></i> Server Control</h4>
                    <div class="setting-group" style="margin-top:20px;">
                        <h4>Auto-Maintenance</h4>
                        <label>Auto-Restart Interval (e.g. 12hrs, 1d, off):</label>
                        <input type="text" id="set-auto-restart" class="input-dark" placeholder="off">
        
                        <label style="margin-top:10px; display:block;">Auto-Backup Interval (e.g. 1hr, 3d, off):</label>
                        <input type="text" id="set-auto-backup" class="input-dark" placeholder="off">
                    </div>
                </div>

                <div class="card full-width">
                    <h4>MOTD & Appearance</h4>
                    <p class="subtext">Use '§' for colors (e.g. §a for green)</p>
                    <input type="text" id="prop-motd" class="input-dark" placeholder="A Minecraft Server">
                    <div class="motd-preview" id="motd-preview">
                        <div style="position: relative; cursor: pointer; display: inline-block;" 
                            title="Click to choose any image — it will be automatically resized to 64×64 PNG and saved as server-icon.png">
                            <img 
                                id="motd-icon" 
                                src="https://minecraft.net/favicon.png" 
                                width="64" 
                                height="64" 
                                style="border-radius: 8px; object-fit: contain; background: #1e1e1e; border: 1px solid #444;"
                                onerror="this.src='https://via.placeholder.com/64?text=No+Icon'; this.style.background='#222';"
                            >
                            <div style="position: absolute; bottom: 6px; right: 6px; 
                                        background: rgba(0,0,0,0.65); color: #ddd; 
                                        font-size: 11px; padding: 3px 7px; border-radius: 4px; 
                                        pointer-events: none; font-weight: 500;">
                                Click to set icon
                            </div>
                        </div>
                        <div style="margin-left: 15px; flex: 1;">
                            <div class="motd-title">Minecraft Server</div>
                            <div class="motd-text" id="motd-render"></div>
                        </div>
                    </div>

                    <!-- Status message for upload feedback -->
                    <p id="icon-status" style="font-size: 12px; color: #8b949e; margin-top: 8px; min-height: 1.2em;"></p>
                </div>

            </div>
            <br>
            <button class="btn-action save-big" id="btn-save-settings">Save Settings & Properties</button>
            <div class="danger-zone" style="margin-top: 50px; border-top: 1px solid #da3633; padding-top: 20px;">
                <h4>Danger Zone</h4>
                <p class="subtext">Forget all app settings and return to setup.</p>
                <button class="btn-action kill" id="btn-reset-data">Reset App Data</button>
            </div>
        </div>
    </div>

    <script src="node_modules/chart.js/dist/chart.umd.js"></script>
    <script src="node_modules/xterm/lib/xterm.js"></script>
    <script src="node_modules/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
    <script src="renderer.js"></script>
</body>
</html>